

 pipeline {
    agent { label 'k3s' }

stages {
        stage('Compilation') {
            steps {
                script {
                    sh '''
                        pwd
                        chmod +x ./build.sh
                        ./build.sh no
                    '''
                }
            }
        }
      stage('Build images') { 
            steps{
                   sh '''
                      podman build -f HPCDockerfile -t hpcimage:${BUILD_NUMBER}
                      podman build -f GDCUDockerfile -t gdcuimage:${BUILD_NUMBER}
                      podman tag hpcimage:${BUILD_NUMBER} localhost:5000/hpcimage:${BUILD_NUMBER}
                      podman tag gdcuimage:${BUILD_NUMBER} localhost:5000/gdcuimage:${BUILD_NUMBER}
                      podman push localhost:5000/hpcimage:${BUILD_NUMBER}
                      podman push localhost:5000/gdcuimage:${BUILD_NUMBER}
                                        
                   '''
            }
                          }
}
}
